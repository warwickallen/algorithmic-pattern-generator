<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DRY Refactoring Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #1a1a1a;
            color: #ffffff;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #333;
            border-radius: 5px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 3px;
        }
        .pass {
            background: #2d5a2d;
            border: 1px solid #4a7c4a;
        }
        .fail {
            background: #5a2d2d;
            border: 1px solid #7c4a4a;
        }
        .info {
            background: #2d2d5a;
            border: 1px solid #4a4a7c;
        }
        button {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 3px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #357abd;
        }
    </style>
</head>
<body>
    <h1>DRY Refactoring Test Results</h1>
    
    <div class="test-section">
        <h2>Configuration Manager Test</h2>
        <div id="config-test-results"></div>
    </div>
    
    <div class="test-section">
        <h2>Shared Components Test</h2>
        <div id="components-test-results"></div>
    </div>
    
    <div class="test-section">
        <h2>Event Handler Test</h2>
        <div id="event-test-results"></div>
    </div>
    
    <div class="test-section">
        <h2>Control Manager Test</h2>
        <div id="control-test-results"></div>
    </div>
    
    <div class="test-section">
        <h2>Keyboard Handler Test</h2>
        <div id="keyboard-test-results"></div>
    </div>
    
    <div class="test-section">
        <h2>Modal Manager Test</h2>
        <div id="modal-test-results"></div>
    </div>
    
    <button onclick="runAllTests()">Run All Tests</button>
    <button onclick="clearResults()">Clear Results</button>

    <script>
        // Mock DOM elements for testing
        const mockElements = {
            'speed-slider': { addEventListener: () => {}, value: '30' },
            'speed-value': { textContent: '' },
            'random-btn': { addEventListener: () => {} },
            'learn-btn': { addEventListener: () => {} },
            'termite-speed-slider': { addEventListener: () => {}, value: '1' },
            'termite-speed-value': { textContent: '' },
            'termites-slider': { addEventListener: () => {}, value: '50' },
            'termites-value': { textContent: '' },
            'termite-random-btn': { addEventListener: () => {} },
            'termite-learn-btn': { addEventListener: () => {} },
            'langton-speed-slider': { addEventListener: () => {}, value: '30' },
            'langton-speed-value': { textContent: '' },
            'add-ant-btn': { addEventListener: () => {} },
            'langton-random-btn': { addEventListener: () => {} },
            'langton-learn-btn': { addEventListener: () => {} },
            'conway-controls': { style: { display: 'none' } },
            'termite-controls': { style: { display: 'none' } },
            'langton-controls': { style: { display: 'none' } },
            'conway-modal': { classList: { add: () => {}, remove: () => {}, contains: () => false } },
            'termite-modal': { classList: { add: () => {}, remove: () => {}, contains: () => false } },
            'langton-modal': { classList: { add: () => {}, remove: () => {}, contains: () => false } }
        };

        // Mock document.getElementById
        const originalGetElementById = document.getElementById;
        document.getElementById = function(id) {
            return mockElements[id] || originalGetElementById.call(document, id);
        };

        // Test results container
        let testResults = {};

        function addTestResult(section, testName, passed, message = '') {
            if (!testResults[section]) {
                testResults[section] = [];
            }
            
            const result = {
                name: testName,
                passed: passed,
                message: message
            };
            
            testResults[section].push(result);
            displayTestResult(section, result);
        }

        function displayTestResult(section, result) {
            const container = document.getElementById(`${section}-test-results`);
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${result.passed ? 'pass' : 'fail'}`;
            resultDiv.innerHTML = `
                <strong>${result.passed ? '✓ PASS' : '✗ FAIL'}</strong>: ${result.name}
                ${result.message ? `<br><small>${result.message}</small>` : ''}
            `;
            container.appendChild(resultDiv);
        }

        function testConfigurationManager() {
            addTestResult('config', 'ConfigurationManager exists', typeof ConfigurationManager !== 'undefined');
            
            if (typeof ConfigurationManager !== 'undefined') {
                addTestResult('config', 'getConfig method exists', typeof ConfigurationManager.getConfig === 'function');
                addTestResult('config', 'getAllConfigs method exists', typeof ConfigurationManager.getAllConfigs === 'function');
                
                const configs = ConfigurationManager.getAllConfigs();
                addTestResult('config', 'Has Conway config', configs.hasOwnProperty('conway'));
                addTestResult('config', 'Has Termite config', configs.hasOwnProperty('termite'));
                addTestResult('config', 'Has Langton config', configs.hasOwnProperty('langton'));
                
                const conwayConfig = ConfigurationManager.getConfig('conway');
                addTestResult('config', 'Conway config has controls', conwayConfig && conwayConfig.controls);
                addTestResult('config', 'Conway config has modal', conwayConfig && conwayConfig.modal);
            }
        }

        function testSharedComponents() {
            addTestResult('components', 'SharedComponents exists', typeof SharedComponents !== 'undefined');
            
            if (typeof SharedComponents !== 'undefined') {
                addTestResult('components', 'createSlider method exists', typeof SharedComponents.createSlider === 'function');
                addTestResult('components', 'createButton method exists', typeof SharedComponents.createButton === 'function');
                addTestResult('components', 'createControlGroup method exists', typeof SharedComponents.createControlGroup === 'function');
            }
        }

        function testEventHandler() {
            addTestResult('event', 'EventHandler class exists', typeof EventHandler !== 'undefined');
            
            if (typeof EventHandler !== 'undefined') {
                const mockApp = { handleSpeedChange: () => {}, handleRandomPattern: () => {}, showLearnModal: () => {}, handleAddAnt: () => {} };
                const eventHandler = new EventHandler(mockApp);
                
                addTestResult('event', 'EventHandler constructor works', eventHandler !== null);
                addTestResult('event', 'registerAllHandlers method exists', typeof eventHandler.registerAllHandlers === 'function');
                addTestResult('event', 'handlers Map exists', eventHandler.handlers instanceof Map);
            }
        }

        function testControlManager() {
            addTestResult('control', 'ControlManager class exists', typeof ControlManager !== 'undefined');
            
            if (typeof ControlManager !== 'undefined') {
                const controlManager = new ControlManager();
                
                addTestResult('control', 'ControlManager constructor works', controlManager !== null);
                addTestResult('control', 'showControls method exists', typeof controlManager.showControls === 'function');
                addTestResult('control', 'hideAllControls method exists', typeof controlManager.hideAllControls === 'function');
                addTestResult('control', 'updateControlValues method exists', typeof controlManager.updateControlValues === 'function');
            }
        }

        function testKeyboardHandler() {
            addTestResult('keyboard', 'KeyboardHandler class exists', typeof KeyboardHandler !== 'undefined');
            
            if (typeof KeyboardHandler !== 'undefined') {
                const mockApp = { 
                    toggleSimulation: () => {}, 
                    resetSimulation: () => {}, 
                    clearSimulation: () => {}, 
                    toggleImmersiveMode: () => {},
                    handleEscape: () => {},
                    adjustSpeed: () => {},
                    handleAddAnt: () => {},
                    adjustBrightness: () => {},
                    resetBrightness: () => {},
                    currentType: 'conway'
                };
                const keyboardHandler = new KeyboardHandler(mockApp);
                
                addTestResult('keyboard', 'KeyboardHandler constructor works', keyboardHandler !== null);
                addTestResult('keyboard', 'handleKeydown method exists', typeof keyboardHandler.handleKeydown === 'function');
                addTestResult('keyboard', 'shortcuts Map exists', keyboardHandler.shortcuts instanceof Map);
            }
        }

        function testModalManager() {
            addTestResult('modal', 'ModalManager class exists', typeof ModalManager !== 'undefined');
            
            if (typeof ModalManager !== 'undefined') {
                const modalManager = new ModalManager();
                
                addTestResult('modal', 'ModalManager constructor works', modalManager !== null);
                addTestResult('modal', 'register method exists', typeof modalManager.register === 'function');
                addTestResult('modal', 'show method exists', typeof modalManager.show === 'function');
                addTestResult('modal', 'hide method exists', typeof modalManager.hide === 'function');
                addTestResult('modal', 'hideAll method exists', typeof modalManager.hideAll === 'function');
                addTestResult('modal', 'isVisible method exists', typeof modalManager.isVisible === 'function');
                addTestResult('modal', 'modals Map exists', modalManager.modals instanceof Map);
            }
        }

        function runAllTests() {
            // Clear previous results
            clearResults();
            
            // Run all test suites
            testConfigurationManager();
            testSharedComponents();
            testEventHandler();
            testControlManager();
            testKeyboardHandler();
            testModalManager();
            
            // Summary
            const totalTests = Object.values(testResults).flat().length;
            const passedTests = Object.values(testResults).flat().filter(r => r.passed).length;
            
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'test-result info';
            summaryDiv.innerHTML = `
                <strong>Test Summary</strong><br>
                Total Tests: ${totalTests}<br>
                Passed: ${passedTests}<br>
                Failed: ${totalTests - passedTests}<br>
                Success Rate: ${Math.round((passedTests / totalTests) * 100)}%
            `;
            document.body.appendChild(summaryDiv);
        }

        function clearResults() {
            testResults = {};
            document.querySelectorAll('.test-result').forEach(el => el.remove());
        }

        // Load the app.js file to test the refactored code
        const script = document.createElement('script');
        script.src = 'app.js';
        script.onload = () => {
            addTestResult('info', 'App.js loaded successfully', true, 'DRY refactored code loaded and ready for testing');
        };
        script.onerror = () => {
            addTestResult('info', 'App.js failed to load', false, 'Check that app.js exists and has no syntax errors');
        };
        document.head.appendChild(script);
    </script>
</body>
</html> 