<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cell Toggling Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }
        .test-container {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 3px;
        }
        .pass {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .fail {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        canvas {
            border: 1px solid #ccc;
            margin: 10px 0;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 3px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <h1>Cell Toggling Test Suite</h1>
    <p>This test verifies that cell toggling works for all three simulations using DRY principles.</p>
    
    <div class="test-container">
        <h2>Conway's Game of Life Cell Toggling</h2>
        <canvas id="conway-canvas" width="200" height="200"></canvas>
        <br>
        <button onclick="testConwayToggling()">Test Conway Cell Toggle</button>
        <div id="conway-result"></div>
    </div>
    
    <div class="test-container">
        <h2>Termite Algorithm Cell Toggling</h2>
        <canvas id="termite-canvas" width="200" height="200"></canvas>
        <br>
        <button onclick="testTermiteToggling()">Test Termite Cell Toggle</button>
        <div id="termite-result"></div>
    </div>
    
    <div class="test-container">
        <h2>Langton's Ant Cell Toggling</h2>
        <canvas id="langton-canvas" width="200" height="200"></canvas>
        <br>
        <button onclick="testLangtonToggling()">Test Langton Cell Toggle</button>
        <div id="langton-result"></div>
    </div>
    
    <div class="test-container">
        <h2>DRY Principles Verification</h2>
        <button onclick="testDRYPrinciples()">Test DRY Implementation</button>
        <div id="dry-result"></div>
    </div>

    <script src="simulations.js"></script>
    <script>
        // Test Conway's Game of Life cell toggling
        function testConwayToggling() {
            const canvas = document.getElementById('conway-canvas');
            const ctx = canvas.getContext('2d');
            const resultDiv = document.getElementById('conway-result');
            
            try {
                const simulation = new ConwayGameOfLife(canvas, ctx);
                simulation.init();
                
                const initialCount = simulation.cellCount;
                simulation.toggleCell(50, 50);
                const afterToggleCount = simulation.cellCount;
                
                const passed = afterToggleCount !== initialCount;
                const message = passed ? 
                    `✓ Cell count changed from ${initialCount} to ${afterToggleCount}` :
                    `✗ Cell count unchanged (${initialCount})`;
                
                resultDiv.innerHTML = `<div class="test-result ${passed ? 'pass' : 'fail'}">${message}</div>`;
                
                // Test second toggle to verify it can be toggled back
                simulation.toggleCell(50, 50);
                const finalCount = simulation.cellCount;
                const toggleBackWorks = finalCount === initialCount;
                
                if (toggleBackWorks) {
                    resultDiv.innerHTML += `<div class="test-result pass">✓ Cell can be toggled back (count: ${finalCount})</div>`;
                } else {
                    resultDiv.innerHTML += `<div class="test-result fail">✗ Cell toggle back failed (count: ${finalCount}, expected: ${initialCount})</div>`;
                }
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="test-result fail">✗ Error: ${error.message}</div>`;
            }
        }
        
        // Test Termite Algorithm cell toggling
        function testTermiteToggling() {
            const canvas = document.getElementById('termite-canvas');
            const ctx = canvas.getContext('2d');
            const resultDiv = document.getElementById('termite-result');
            
            try {
                const simulation = new TermiteAlgorithm(canvas, ctx);
                simulation.init();
                
                const initialCount = simulation.cellCount;
                simulation.toggleCell(50, 50);
                const afterToggleCount = simulation.cellCount;
                
                const passed = afterToggleCount !== initialCount;
                const message = passed ? 
                    `✓ Wood chip count changed from ${initialCount} to ${afterToggleCount}` :
                    `✗ Wood chip count unchanged (${initialCount})`;
                
                resultDiv.innerHTML = `<div class="test-result ${passed ? 'pass' : 'fail'}">${message}</div>`;
                
                // Test second toggle to verify it can be toggled back
                simulation.toggleCell(50, 50);
                const finalCount = simulation.cellCount;
                const toggleBackWorks = finalCount === initialCount;
                
                if (toggleBackWorks) {
                    resultDiv.innerHTML += `<div class="test-result pass">✓ Wood chip can be toggled back (count: ${finalCount})</div>`;
                } else {
                    resultDiv.innerHTML += `<div class="test-result fail">✗ Wood chip toggle back failed (count: ${finalCount}, expected: ${initialCount})</div>`;
                }
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="test-result fail">✗ Error: ${error.message}</div>`;
            }
        }
        
        // Test Langton's Ant cell toggling
        function testLangtonToggling() {
            const canvas = document.getElementById('langton-canvas');
            const ctx = canvas.getContext('2d');
            const resultDiv = document.getElementById('langton-result');
            
            try {
                const simulation = new LangtonsAnt(canvas, ctx);
                simulation.init();
                
                const initialCount = simulation.cellCount;
                simulation.toggleCell(50, 50);
                const afterToggleCount = simulation.cellCount;
                
                const passed = afterToggleCount !== initialCount;
                const message = passed ? 
                    `✓ Cell count changed from ${initialCount} to ${afterToggleCount}` :
                    `✗ Cell count unchanged (${initialCount})`;
                
                resultDiv.innerHTML = `<div class="test-result ${passed ? 'pass' : 'fail'}">${message}</div>`;
                
                // Test second toggle to verify it can be toggled back
                simulation.toggleCell(50, 50);
                const finalCount = simulation.cellCount;
                const toggleBackWorks = finalCount === initialCount;
                
                if (toggleBackWorks) {
                    resultDiv.innerHTML += `<div class="test-result pass">✓ Cell can be toggled back (count: ${finalCount})</div>`;
                } else {
                    resultDiv.innerHTML += `<div class="test-result fail">✗ Cell toggle back failed (count: ${finalCount}, expected: ${initialCount})</div>`;
                }
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="test-result fail">✗ Error: ${error.message}</div>`;
            }
        }
        
        // Test DRY principles implementation
        function testDRYPrinciples() {
            const resultDiv = document.getElementById('dry-result');
            let results = [];
            
            try {
                // Test 1: Check if all simulations have toggleCell method
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                const conway = new ConwayGameOfLife(canvas, ctx);
                const termite = new TermiteAlgorithm(canvas, ctx);
                const langton = new LangtonsAnt(canvas, ctx);
                
                const hasConwayToggle = typeof conway.toggleCell === 'function';
                const hasTermiteToggle = typeof termite.toggleCell === 'function';
                const hasLangtonToggle = typeof langton.toggleCell === 'function';
                
                results.push({
                    test: 'All simulations have toggleCell method',
                    passed: hasConwayToggle && hasTermiteToggle && hasLangtonToggle,
                    details: `Conway: ${hasConwayToggle}, Termite: ${hasTermiteToggle}, Langton: ${hasLangtonToggle}`
                });
                
                // Test 2: Check if BaseSimulation has generic toggleCell method
                const baseHasToggle = typeof BaseSimulation.prototype.toggleCell === 'function';
                results.push({
                    test: 'BaseSimulation has generic toggleCell method',
                    passed: baseHasToggle,
                    details: 'Generic method provides default implementation'
                });
                
                // Test 3: Check if each simulation overrides the base method
                const conwayOverrides = conway.toggleCell !== BaseSimulation.prototype.toggleCell;
                const termiteOverrides = termite.toggleCell !== BaseSimulation.prototype.toggleCell;
                const langtonOverrides = langton.toggleCell !== BaseSimulation.prototype.toggleCell;
                
                results.push({
                    test: 'Each simulation overrides base toggleCell method',
                    passed: conwayOverrides && termiteOverrides && langtonOverrides,
                    details: `Conway: ${conwayOverrides}, Termite: ${termiteOverrides}, Langton: ${langtonOverrides}`
                });
                
                // Test 4: Check if all simulations use common coordinate conversion
                const conwayHasScreenToGrid = typeof conway.screenToGrid === 'function';
                const termiteHasScreenToGrid = typeof termite.screenToGrid === 'function';
                const langtonHasScreenToGrid = typeof langton.screenToGrid === 'function';
                
                results.push({
                    test: 'All simulations use common coordinate conversion',
                    passed: conwayHasScreenToGrid && termiteHasScreenToGrid && langtonHasScreenToGrid,
                    details: 'DRY principle: coordinate conversion shared across simulations'
                });
                
                // Display results
                let html = '';
                results.forEach(result => {
                    const className = result.passed ? 'pass' : 'fail';
                    html += `<div class="test-result ${className}">
                        <strong>${result.test}:</strong> ${result.passed ? '✓ PASS' : '✗ FAIL'}<br>
                        <em>${result.details}</em>
                    </div>`;
                });
                
                resultDiv.innerHTML = html;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="test-result fail">✗ Error testing DRY principles: ${error.message}</div>`;
            }
        }
        
        // Auto-run tests when page loads
        window.addEventListener('load', () => {
            setTimeout(() => {
                testConwayToggling();
                testTermiteToggling();
                testLangtonToggling();
                testDRYPrinciples();
            }, 1000);
        });
    </script>
</body>
</html> 