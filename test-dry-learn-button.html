<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DRY Learn Button Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .pass {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .fail {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .test-controls {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>DRY Learn Button Implementation Test</h1>
    
    <div class="test-section">
        <h2>Test Overview</h2>
        <p>This test verifies that the Learn button implementation is now DRY (Don't Repeat Yourself) and works correctly across all simulations:</p>
        <ul>
            <li><strong>Single Button:</strong> Only one Learn button exists in the HTML</li>
            <li><strong>Dynamic Behaviour:</strong> The button shows the correct modal based on the currently selected simulation</li>
            <li><strong>Proper Visibility:</strong> The button is only visible when a simulation is active</li>
            <li><strong>No Duplicate Buttons:</strong> No leftover buttons from previous simulations remain visible</li>
            <li><strong>Correct Modal Content:</strong> Each simulation displays its appropriate educational content in the modal</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>Automated Tests</h2>
        <div class="test-controls">
            <button onclick="runAllTests()">Run All Tests</button>
            <button onclick="testSingleButton()">Test Single Button</button>
            <button onclick="testDynamicBehaviour()">Test Dynamic Behaviour</button>
            <button onclick="testButtonVisibility()">Test Button Visibility</button>
            <button onclick="testModalContent()">Test Modal Content</button>
        </div>
        <div id="test-results"></div>
    </div>

    <div class="test-section">
        <h2>Manual Testing</h2>
        <p>Use the application below to manually test the Learn button functionality:</p>
        <div class="test-controls">
            <button onclick="switchToConway()">Switch to Conway</button>
            <button onclick="switchToTermite()">Switch to Termite</button>
            <button onclick="switchToLangton()">Switch to Langton</button>
            <button onclick="clickLearnButton()">Click Learn Button</button>
        </div>
        <iframe id="app-frame" src="index.html"></iframe>
    </div>

    <script>
        let testResults = [];

        function logTest(testName, passed, message) {
            const result = {
                name: testName,
                passed: passed,
                message: message,
                timestamp: new Date().toISOString()
            };
            testResults.push(result);
            displayTestResult(result);
        }

        function displayTestResult(result) {
            const resultsDiv = document.getElementById('test-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${result.passed ? 'pass' : 'fail'}`;
            resultDiv.innerHTML = `
                <strong>${result.name}:</strong> ${result.passed ? 'PASS' : 'FAIL'}
                <br><small>${result.message}</small>
            `;
            resultsDiv.appendChild(resultDiv);
        }

        function clearTestResults() {
            document.getElementById('test-results').innerHTML = '';
            testResults = [];
        }

        function getAppFrame() {
            return document.getElementById('app-frame').contentWindow;
        }

        function testSingleButton() {
            clearTestResults();
            
            try {
                const app = getAppFrame();
                const learnButtons = app.document.querySelectorAll('#learn-btn');
                
                if (learnButtons.length === 1) {
                    logTest('Single Learn Button', true, 'Only one Learn button exists in the DOM');
                } else {
                    logTest('Single Learn Button', false, `Found ${learnButtons.length} Learn buttons instead of 1`);
                }

                // Check that old specific buttons don't exist
                const termiteLearnBtn = app.document.querySelector('#termite-learn-btn');
                const langtonLearnBtn = app.document.querySelector('#langton-learn-btn');
                
                if (!termiteLearnBtn && !langtonLearnBtn) {
                    logTest('No Duplicate Buttons', true, 'Old simulation-specific Learn buttons have been removed');
                } else {
                    logTest('No Duplicate Buttons', false, 'Old simulation-specific Learn buttons still exist');
                }

            } catch (error) {
                logTest('Single Learn Button', false, `Error: ${error.message}`);
            }
        }

        function testDynamicBehaviour() {
            clearTestResults();
            
            try {
                const app = getAppFrame();
                
                // Test Conway
                app.switchSimulation('conway');
                setTimeout(() => {
                    const learnBtn = app.document.querySelector('#learn-btn');
                    if (learnBtn && learnBtn.style.display !== 'none') {
                        logTest('Conway Learn Button Visible', true, 'Learn button is visible for Conway simulation');
                    } else {
                        logTest('Conway Learn Button Visible', false, 'Learn button is not visible for Conway simulation');
                    }
                }, 100);

                // Test Termite
                setTimeout(() => {
                    app.switchSimulation('termite');
                    setTimeout(() => {
                        const learnBtn = app.document.querySelector('#learn-btn');
                        if (learnBtn && learnBtn.style.display !== 'none') {
                            logTest('Termite Learn Button Visible', true, 'Learn button is visible for Termite simulation');
                        } else {
                            logTest('Termite Learn Button Visible', false, 'Learn button is not visible for Termite simulation');
                        }
                    }, 100);
                }, 200);

                // Test Langton
                setTimeout(() => {
                    app.switchSimulation('langton');
                    setTimeout(() => {
                        const learnBtn = app.document.querySelector('#learn-btn');
                        if (learnBtn && learnBtn.style.display !== 'none') {
                            logTest('Langton Learn Button Visible', true, 'Learn button is visible for Langton simulation');
                        } else {
                            logTest('Langton Learn Button Visible', false, 'Learn button is not visible for Langton simulation');
                        }
                    }, 100);
                }, 400);

            } catch (error) {
                logTest('Dynamic Behaviour', false, `Error: ${error.message}`);
            }
        }

        function testButtonVisibility() {
            clearTestResults();
            
            try {
                const app = getAppFrame();
                
                // Test that only one button is visible at a time
                const learnBtn = app.document.querySelector('#learn-btn');
                if (learnBtn) {
                    const isVisible = learnBtn.style.display !== 'none';
                    logTest('Button Visibility State', true, `Learn button visibility: ${isVisible ? 'visible' : 'hidden'}`);
                } else {
                    logTest('Button Visibility State', false, 'Learn button not found');
                }

                // Test that no other Learn buttons exist
                const allLearnButtons = app.document.querySelectorAll('[id*="learn-btn"]');
                if (allLearnButtons.length === 1) {
                    logTest('No Extra Learn Buttons', true, 'Only one Learn button exists in the entire DOM');
                } else {
                    logTest('No Extra Learn Buttons', false, `Found ${allLearnButtons.length} Learn buttons instead of 1`);
                }

            } catch (error) {
                logTest('Button Visibility', false, `Error: ${error.message}`);
            }
        }

        function testModalContent() {
            clearTestResults();
            
            try {
                const app = getAppFrame();
                
                // Test Conway modal content
                app.switchSimulation('conway');
                setTimeout(() => {
                    const learnBtn = app.document.querySelector('#learn-btn');
                    if (learnBtn) {
                        learnBtn.click();
                        setTimeout(() => {
                            const conwayModal = app.document.querySelector('#conway-modal');
                            if (conwayModal && conwayModal.style.display === 'block') {
                                const modalTitle = conwayModal.querySelector('h2');
                                if (modalTitle && modalTitle.textContent.includes('Conway')) {
                                    logTest('Conway Modal Content', true, 'Conway modal displays correct content');
                                } else {
                                    logTest('Conway Modal Content', false, 'Conway modal title incorrect');
                                }
                            } else {
                                logTest('Conway Modal Content', false, 'Conway modal not displayed');
                            }
                            
                            // Close modal and test Termite
                            const closeBtn = app.document.querySelector('#conway-modal-close');
                            if (closeBtn) closeBtn.click();
                            
                            setTimeout(() => {
                                app.switchSimulation('termite');
                                setTimeout(() => {
                                    const learnBtn = app.document.querySelector('#learn-btn');
                                    if (learnBtn) {
                                        learnBtn.click();
                                        setTimeout(() => {
                                            const termiteModal = app.document.querySelector('#termite-modal');
                                            if (termiteModal && termiteModal.style.display === 'block') {
                                                const modalTitle = termiteModal.querySelector('h2');
                                                if (modalTitle && modalTitle.textContent.includes('Termite')) {
                                                    logTest('Termite Modal Content', true, 'Termite modal displays correct content');
                                                } else {
                                                    logTest('Termite Modal Content', false, 'Termite modal title incorrect');
                                                }
                                            } else {
                                                logTest('Termite Modal Content', false, 'Termite modal not displayed');
                                            }
                                            
                                            // Close modal and test Langton
                                            const closeBtn = app.document.querySelector('#termite-modal-close');
                                            if (closeBtn) closeBtn.click();
                                            
                                            setTimeout(() => {
                                                app.switchSimulation('langton');
                                                setTimeout(() => {
                                                    const learnBtn = app.document.querySelector('#learn-btn');
                                                    if (learnBtn) {
                                                        learnBtn.click();
                                                        setTimeout(() => {
                                                            const langtonModal = app.document.querySelector('#langton-modal');
                                                            if (langtonModal && langtonModal.style.display === 'block') {
                                                                const modalTitle = langtonModal.querySelector('h2');
                                                                if (modalTitle && modalTitle.textContent.includes('Langton')) {
                                                                    logTest('Langton Modal Content', true, 'Langton modal displays correct content');
                                                                } else {
                                                                    logTest('Langton Modal Content', false, 'Langton modal title incorrect');
                                                                }
                                                            } else {
                                                                logTest('Langton Modal Content', false, 'Langton modal not displayed');
                                                            }
                                                            
                                                            // Close modal
                                                            const closeBtn = app.document.querySelector('#langton-modal-close');
                                                            if (closeBtn) closeBtn.click();
                                                            
                                                        }, 100);
                                                    } else {
                                                        logTest('Langton Modal Content', false, 'Learn button not found for Langton');
                                                    }
                                                }, 100);
                                            }, 100);
                                        }, 100);
                                    } else {
                                        logTest('Termite Modal Content', false, 'Learn button not found for Termite');
                                    }
                                }, 100);
                            }, 100);
                        }, 100);
                    } else {
                        logTest('Conway Modal Content', false, 'Learn button not found for Conway');
                    }
                }, 100);

            } catch (error) {
                logTest('Modal Content Test', false, `Error: ${error.message}`);
            }
        }

        function runAllTests() {
            clearTestResults();
            testSingleButton();
            setTimeout(() => testDynamicBehaviour(), 100);
            setTimeout(() => testButtonVisibility(), 600);
            setTimeout(() => testModalContent(), 800);
        }

        // Manual testing functions
        function switchToConway() {
            const app = getAppFrame();
            app.switchSimulation('conway');
            logTest('Manual Test - Conway', true, 'Switched to Conway simulation');
        }

        function switchToTermite() {
            const app = getAppFrame();
            app.switchSimulation('termite');
            logTest('Manual Test - Termite', true, 'Switched to Termite simulation');
        }

        function switchToLangton() {
            const app = getAppFrame();
            app.switchSimulation('langton');
            logTest('Manual Test - Langton', true, 'Switched to Langton simulation');
        }

        function clickLearnButton() {
            const app = getAppFrame();
            const learnBtn = app.document.querySelector('#learn-btn');
            if (learnBtn) {
                learnBtn.click();
                logTest('Manual Test - Learn Click', true, 'Clicked Learn button');
            } else {
                logTest('Manual Test - Learn Click', false, 'Learn button not found');
            }
        }

        // Auto-run tests when page loads
        window.addEventListener('load', () => {
            setTimeout(() => {
                logTest('Page Load', true, 'Test page loaded successfully');
            }, 1000);
        });
    </script>
</body>
</html> 