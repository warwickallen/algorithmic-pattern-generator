<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Termite Slider Fix Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        
        .test-result.pass {
            background: #E8F5E8;
            border-left: 4px solid #4CAF50;
        }
        
        .test-result.fail {
            background: #FFEBEE;
            border-left: 4px solid #f44336;
        }
        
        .control-group {
            margin: 15px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .control-group label {
            display: inline-block;
            width: 120px;
            font-weight: bold;
        }
        
        .control-group input[type="range"] {
            width: 200px;
            margin: 0 10px;
        }
        
        .control-group span {
            font-family: monospace;
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 3px;
        }
        
        .canvas-container {
            margin: 20px 0;
            text-align: center;
        }
        
        #test-canvas {
            border: 2px solid #ddd;
            border-radius: 5px;
        }
        
        .info {
            background: #E3F2FD;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Termite Slider Fix Test</h1>
        
        <div class="info">
            <h3>Test Description</h3>
            <p>This test verifies that the termite slider functionality is working correctly after the fix.</p>
            <p>The test will:</p>
            <ul>
                <li>Create a termite simulation</li>
                <li>Test the setTermiteCount method directly</li>
                <li>Test the slider integration with EventFramework and ControlManager</li>
                <li>Verify that termite count changes when slider is moved</li>
            </ul>
        </div>
        
        <div class="control-group">
            <label for="termites-slider">Termites:</label>
            <input type="range" id="termites-slider" min="10" max="100" value="50" class="slider">
            <span id="termites-value">50</span>
        </div>
        
        <div class="canvas-container">
            <canvas id="test-canvas" width="400" height="300"></canvas>
        </div>
        
        <div id="test-results"></div>
        
        <button onclick="runTests()" style="padding: 10px 20px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer;">
            Run Tests
        </button>
    </div>

    <script src="i18n.js"></script>
    <script src="simulations.js"></script>
    <script src="app.js"></script>
    
    <script>
        function addTestResult(name, passed, details) {
            const resultsDiv = document.getElementById('test-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${passed ? 'pass' : 'fail'}`;
            resultDiv.innerHTML = `
                <strong>${name}:</strong> ${passed ? 'PASS' : 'FAIL'}
                <br><small>${details}</small>
            `;
            resultsDiv.appendChild(resultDiv);
        }
        
        async function runTests() {
            // Clear previous results
            document.getElementById('test-results').innerHTML = '';
            
            const canvas = document.getElementById('test-canvas');
            const ctx = canvas.getContext('2d');
            
            // Test 1: Direct setTermiteCount method
            try {
                const simulation = new TermiteAlgorithm(canvas, ctx);
                simulation.init();
                
                const initialCount = simulation.termites.length;
                const newCount = 25;
                simulation.setTermiteCount(newCount);
                const afterChangeCount = simulation.termites.length;
                
                const passed = afterChangeCount === newCount && afterChangeCount !== initialCount;
                addTestResult(
                    'Direct setTermiteCount Test',
                    passed,
                    `Termite count changed from ${initialCount} to ${afterChangeCount} (expected ${newCount})`
                );
            } catch (error) {
                addTestResult(
                    'Direct setTermiteCount Test',
                    false,
                    `Error: ${error.message}`
                );
            }
            
            // Test 2: Slider Integration Test
            try {
                const sliderElement = document.getElementById('termites-slider');
                const valueElement = document.getElementById('termites-value');
                
                // Create a new simulation for this test
                const testCanvas = document.createElement('canvas');
                testCanvas.width = 400;
                testCanvas.height = 300;
                const testCtx = testCanvas.getContext('2d');
                
                const simulation = new TermiteAlgorithm(testCanvas, testCtx);
                simulation.init();
                
                // Create mock app with handleTermiteCountChange method
                const mockApp = {
                    handleTermiteCountChange: (count) => {
                        simulation.setTermiteCount(count);
                    }
                };
                
                // Create EventFramework and ControlManager
                const eventFramework = new EventFramework();
                const controlManager = new ControlManager(eventFramework);
                
                // Register termite handlers
                controlManager.registerSimulationHandlers('termite', mockApp);
                
                // Get initial termite count
                const initialCount = simulation.termites.length;
                
                // Simulate slider change
                sliderElement.value = '30';
                sliderElement.dispatchEvent(new Event('change'));
                
                // Wait a bit for the event to process
                await new Promise(resolve => setTimeout(resolve, 100));
                
                // Check if termite count changed
                const afterChangeCount = simulation.termites.length;
                
                // Clean up
                eventFramework.cleanup();
                controlManager.cleanup();
                
                const passed = afterChangeCount === 30 && afterChangeCount !== initialCount;
                addTestResult(
                    'Slider Integration Test',
                    passed,
                    `Termite slider integration: count changed from ${initialCount} to ${afterChangeCount} (expected 30)`
                );
            } catch (error) {
                addTestResult(
                    'Slider Integration Test',
                    false,
                    `Error: ${error.message}`
                );
            }
            
            // Test 3: Real-time slider interaction
            try {
                const sliderElement = document.getElementById('termites-slider');
                const valueElement = document.getElementById('termites-value');
                
                // Create a new simulation for this test
                const testCanvas = document.createElement('canvas');
                testCanvas.width = 400;
                testCanvas.height = 300;
                const testCtx = testCanvas.getContext('2d');
                
                const simulation = new TermiteAlgorithm(testCanvas, testCtx);
                simulation.init();
                
                // Create mock app with handleTermiteCountChange method
                const mockApp = {
                    handleTermiteCountChange: (count) => {
                        simulation.setTermiteCount(count);
                        // Update the display value
                        if (valueElement) {
                            valueElement.textContent = count;
                        }
                    }
                };
                
                // Create EventFramework and ControlManager
                const eventFramework = new EventFramework();
                const controlManager = new ControlManager(eventFramework);
                
                // Register termite handlers
                controlManager.registerSimulationHandlers('termite', mockApp);
                
                // Get initial termite count
                const initialCount = simulation.termites.length;
                
                // Simulate multiple slider changes
                const testValues = [15, 40, 75, 20];
                let allPassed = true;
                let details = '';
                
                for (let i = 0; i < testValues.length; i++) {
                    const testValue = testValues[i];
                    sliderElement.value = testValue;
                    sliderElement.dispatchEvent(new Event('change'));
                    
                    // Wait a bit for the event to process
                    await new Promise(resolve => setTimeout(resolve, 50));
                    
                    const currentCount = simulation.termites.length;
                    if (currentCount !== testValue) {
                        allPassed = false;
                        details += `Failed at value ${testValue}: got ${currentCount}, expected ${testValue}. `;
                    }
                }
                
                // Clean up
                eventFramework.cleanup();
                controlManager.cleanup();
                
                if (allPassed) {
                    details = `All ${testValues.length} slider values tested successfully`;
                }
                
                addTestResult(
                    'Real-time Slider Interaction Test',
                    allPassed,
                    details
                );
            } catch (error) {
                addTestResult(
                    'Real-time Slider Interaction Test',
                    false,
                    `Error: ${error.message}`
                );
            }
        }
        
        // Auto-run tests when page loads
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Termite slider fix test page loaded');
            console.log('Click "Run Tests" to verify the fix');
        });
    </script>
</body>
</html> 