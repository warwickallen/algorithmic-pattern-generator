<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Ant Mouse Position Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f0f0f0;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #1976D2;
        }
        .test-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .success {
            color: #4CAF50;
            font-weight: bold;
        }
        .error {
            color: #f44336;
            font-weight: bold;
        }
        .info {
            color: #2196F3;
        }
        #canvas {
            border: 2px solid #333;
            background: white;
            cursor: crosshair;
        }
        .instructions {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .results {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>Add Ant Mouse Position Test</h1>
    
    <div class="instructions">
        <h3>Test Instructions:</h3>
        <ol>
            <li>Switch to Langton's Ant simulation</li>
            <li>Move your mouse over the canvas to track position</li>
            <li>Click "Add Ant" button or press 'a' key</li>
            <li>Verify the new ant appears under your mouse pointer</li>
            <li>Try clicking outside the canvas area - ant should appear at the nearest valid position</li>
        </ol>
    </div>

    <div class="test-container">
        <h3>Simulation Controls</h3>
        <select id="simulation-select">
            <option value="conway">Conway's Game of Life</option>
            <option value="termite">Termite Algorithm</option>
            <option value="langton">Langton's Ant</option>
        </select>
        
        <button id="start-pause-btn" class="test-button">Start</button>
        <button id="reset-btn" class="test-button">Reset</button>
        <button id="clear-btn" class="test-button">Clear</button>
        <button id="immersive-btn" class="test-button">Immersive Mode</button>
        
        <div id="langton-controls" style="display: none;">
            <h4>Langton's Ant Controls</h4>
            <div>
                <label for="langton-speed-slider">Speed:</label>
                <input type="range" id="langton-speed-slider" min="1" max="60" value="30">
                <span id="langton-speed-value">30</span>
            </div>
            <button id="add-ant-btn" class="test-button">Add Ant</button>
            <button id="langton-random-btn" class="test-button">Random</button>
            <button id="langton-learn-btn" class="test-button">Learn</button>
        </div>
        
        <div id="conway-controls" style="display: none;">
            <h4>Conway's Game of Life Controls</h4>
            <div>
                <label for="conway-speed-slider">Speed:</label>
                <input type="range" id="conway-speed-slider" min="1" max="60" value="30">
                <span id="conway-speed-value">30</span>
            </div>
            <button id="conway-random-btn" class="test-button">Random</button>
            <button id="conway-learn-btn" class="test-button">Learn</button>
        </div>
        
        <div id="termite-controls" style="display: none;">
            <h4>Termite Algorithm Controls</h4>
            <div>
                <label for="termite-speed-slider">Speed:</label>
                <input type="range" id="termite-speed-slider" min="0.5" max="3" step="0.1" value="1">
                <span id="termite-speed-value">1.0x</span>
            </div>
            <div>
                <label for="termite-count-slider">Termites:</label>
                <input type="range" id="termite-count-slider" min="10" max="100" value="50">
                <span id="termite-count-value">50</span>
            </div>
            <button id="termite-random-btn" class="test-button">Random</button>
            <button id="termite-learn-btn" class="test-button">Learn</button>
        </div>
    </div>

    <div class="test-container">
        <h3>Canvas</h3>
        <canvas id="canvas" width="600" height="400"></canvas>
        <p><strong>Mouse Position:</strong> <span id="mouse-position">Not tracked</span></p>
        <p><strong>Ant Count:</strong> <span id="ant-count">0</span></p>
    </div>

    <div class="test-container">
        <h3>Test Results</h3>
        <button class="test-button" onclick="runMousePositionTest()">Run Keyboard Mouse Position Test</button>
        <button class="test-button" onclick="runBoundaryTest()">Run Boundary Test</button>
        <button class="test-button" onclick="runRandomFallbackTest()">Run Button Random Test</button>
        <button class="test-button" onclick="runButtonVsKeyboardTest()">Run Button vs Keyboard Test</button>
        <button class="test-button" onclick="clearResults()">Clear Results</button>
        <div id="results" class="results"></div>
    </div>

    <!-- Modals -->
    <div id="langton-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" id="langton-close">&times;</span>
            <h2>Langton's Ant</h2>
            <p>Langton's Ant follows simple rules that create complex emergent behaviour:</p>
            <ul>
                <li>On a white square, turn 90° right, flip the colour of the square, move forward one unit</li>
                <li>On a black square, turn 90° left, flip the colour of the square, move forward one unit</li>
            </ul>
            <p>Use the speed slider to control ant movement speed, the Add Ant button (or press 'a') to add new ants, and the random button to create a random pattern of white and black cells.</p>
        </div>
    </div>

    <script src="simulations.js"></script>
    <script src="app.js"></script>
    <script>
        let app;
        let testResults = [];

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            app = new AlgorithmicPatternGenerator();
            
            // Update mouse position display
            const canvas = document.getElementById('canvas');
            canvas.addEventListener('mousemove', function(e) {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                document.getElementById('mouse-position').textContent = `(${Math.round(x)}, ${Math.round(y)})`;
            });
            
            // Update ant count display
            setInterval(() => {
                if (app.currentSimulation && app.currentSimulation.ants) {
                    document.getElementById('ant-count').textContent = app.currentSimulation.ants.length;
                }
            }, 100);
        });

        function addResult(testName, passed, message = '') {
            const status = passed ? '✅ PASS' : '❌ FAIL';
            const result = `${status} ${testName}: ${message}`;
            testResults.push(result);
            updateResults();
        }

        function updateResults() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.textContent = testResults.join('\n');
        }

        function clearResults() {
            testResults = [];
            updateResults();
        }

        async function runMousePositionTest() {
            clearResults();
            addResult('Mouse Position Test', true, 'Starting keyboard-triggered mouse position test...');
            
            // Switch to Langton's Ant
            app.switchSimulation('langton');
            await new Promise(resolve => setTimeout(resolve, 100));
            
            // Get initial ant count
            const initialAntCount = app.currentSimulation.ants.length;
            
            // Simulate mouse position at center of canvas
            const canvas = document.getElementById('canvas');
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            // Set mouse position
            app.mouseX = centerX;
            app.mouseY = centerY;
            
            // Add ant with keyboard trigger (useMousePosition = true)
            app.handleAddAnt('langton', true);
            await new Promise(resolve => setTimeout(resolve, 100));
            
            // Check if ant was added
            const newAntCount = app.currentSimulation.ants.length;
            const antAdded = newAntCount > initialAntCount;
            
            if (antAdded) {
                // Check if the new ant is near the mouse position
                const newAnt = app.currentSimulation.ants[newAntCount - 1];
                const gridPos = app.currentSimulation.screenToGrid(centerX, centerY);
                const distance = Math.abs(newAnt.x - gridPos.col) + Math.abs(newAnt.y - gridPos.row);
                
                if (distance <= 1) {
                    addResult('Mouse Position Test', true, `Ant added at mouse position (keyboard). Grid: (${newAnt.x}, ${newAnt.y}), Mouse: (${gridPos.col}, ${gridPos.row})`);
                } else {
                    addResult('Mouse Position Test', false, `Ant not at mouse position (keyboard). Grid: (${newAnt.x}, ${newAnt.y}), Mouse: (${gridPos.col}, ${gridPos.row})`);
                }
            } else {
                addResult('Mouse Position Test', false, 'No ant was added with keyboard trigger');
            }
        }

        async function runBoundaryTest() {
            addResult('Boundary Test', true, 'Starting boundary test (keyboard trigger)...');
            
            // Switch to Langton's Ant
            app.switchSimulation('langton');
            await new Promise(resolve => setTimeout(resolve, 100));
            
            // Test adding ant outside canvas bounds
            app.mouseX = -100; // Outside left
            app.mouseY = -100; // Outside top
            app.handleAddAnt('langton', true);
            await new Promise(resolve => setTimeout(resolve, 100));
            
            const antCount = app.currentSimulation.ants.length;
            const lastAnt = app.currentSimulation.ants[antCount - 1];
            
            // Check if ant is clamped to valid bounds
            const isValidPosition = lastAnt.x >= 0 && lastAnt.x < app.currentSimulation.cols && 
                                   lastAnt.y >= 0 && lastAnt.y < app.currentSimulation.rows;
            
            if (isValidPosition) {
                addResult('Boundary Test', true, `Ant clamped to valid position (keyboard): (${lastAnt.x}, ${lastAnt.y})`);
            } else {
                addResult('Boundary Test', false, `Ant at invalid position (keyboard): (${lastAnt.x}, ${lastAnt.y})`);
            }
        }

        async function runRandomFallbackTest() {
            addResult('Random Fallback Test', true, 'Starting button-triggered random placement test...');
            
            // Switch to Langton's Ant
            app.switchSimulation('langton');
            await new Promise(resolve => setTimeout(resolve, 100));
            
            // Set mouse position to a known location
            app.mouseX = 100;
            app.mouseY = 100;
            
            const initialAntCount = app.currentSimulation.ants.length;
            // Add ant with button trigger (useMousePosition = false, default)
            app.handleAddAnt('langton', false);
            await new Promise(resolve => setTimeout(resolve, 100));
            
            const newAntCount = app.currentSimulation.ants.length;
            const antAdded = newAntCount > initialAntCount;
            
            if (antAdded) {
                const newAnt = app.currentSimulation.ants[newAntCount - 1];
                const isValidPosition = newAnt.x >= 0 && newAnt.x < app.currentSimulation.cols && 
                                       newAnt.y >= 0 && newAnt.y < app.currentSimulation.rows;
                
                // Check if ant was placed randomly (not at mouse position)
                const gridPos = app.currentSimulation.screenToGrid(100, 100);
                const distance = Math.abs(newAnt.x - gridPos.col) + Math.abs(newAnt.y - gridPos.row);
                
                if (isValidPosition && distance > 1) {
                    addResult('Random Fallback Test', true, `Button-triggered ant placed randomly at: (${newAnt.x}, ${newAnt.y}), not at mouse: (${gridPos.col}, ${gridPos.row})`);
                } else if (isValidPosition) {
                    addResult('Random Fallback Test', false, `Button-triggered ant placed at mouse position instead of randomly: (${newAnt.x}, ${newAnt.y})`);
                } else {
                    addResult('Random Fallback Test', false, `Button-triggered ant at invalid position: (${newAnt.x}, ${newAnt.y})`);
                }
            } else {
                addResult('Random Fallback Test', false, 'No ant was added with button trigger');
            }
        }

        async function runButtonVsKeyboardTest() {
            clearResults();
            addResult('Button vs Keyboard Test', true, 'Starting comparison test...');
            
            // Switch to Langton's Ant
            app.switchSimulation('langton');
            await new Promise(resolve => setTimeout(resolve, 100));
            
            // Set mouse position to a known location
            const mouseX = 150;
            const mouseY = 150;
            app.mouseX = mouseX;
            app.mouseY = mouseY;
            
            const gridPos = app.currentSimulation.screenToGrid(mouseX, mouseY);
            
            // Test 1: Button trigger (should be random)
            const initialAntCount = app.currentSimulation.ants.length;
            app.handleAddAnt('langton', false); // Button trigger
            await new Promise(resolve => setTimeout(resolve, 100));
            
            const buttonAntCount = app.currentSimulation.ants.length;
            const buttonAntAdded = buttonAntCount > initialAntCount;
            
            if (buttonAntAdded) {
                const buttonAnt = app.currentSimulation.ants[buttonAntCount - 1];
                const buttonDistance = Math.abs(buttonAnt.x - gridPos.col) + Math.abs(buttonAnt.y - gridPos.row);
                
                // Test 2: Keyboard trigger (should be at mouse position)
                app.handleAddAnt('langton', true); // Keyboard trigger
                await new Promise(resolve => setTimeout(resolve, 100));
                
                const keyboardAntCount = app.currentSimulation.ants.length;
                const keyboardAntAdded = keyboardAntCount > buttonAntCount;
                
                if (keyboardAntAdded) {
                    const keyboardAnt = app.currentSimulation.ants[keyboardAntCount - 1];
                    const keyboardDistance = Math.abs(keyboardAnt.x - gridPos.col) + Math.abs(keyboardAnt.y - gridPos.row);
                    
                    // Verify button was random and keyboard was at mouse position
                    if (buttonDistance > 1 && keyboardDistance <= 1) {
                        addResult('Button vs Keyboard Test', true, 
                            `Button: random at (${buttonAnt.x}, ${buttonAnt.y}), Keyboard: at mouse (${keyboardAnt.x}, ${keyboardAnt.y})`);
                    } else if (buttonDistance <= 1) {
                        addResult('Button vs Keyboard Test', false, 
                            `Button incorrectly placed at mouse position: (${buttonAnt.x}, ${buttonAnt.y})`);
                    } else if (keyboardDistance > 1) {
                        addResult('Button vs Keyboard Test', false, 
                            `Keyboard incorrectly placed randomly: (${keyboardAnt.x}, ${keyboardAnt.y})`);
                    } else {
                        addResult('Button vs Keyboard Test', false, 
                            `Both triggers behaved incorrectly`);
                    }
                } else {
                    addResult('Button vs Keyboard Test', false, 'No ant was added with keyboard trigger');
                }
            } else {
                addResult('Button vs Keyboard Test', false, 'No ant was added with button trigger');
            }
        }
    </script>
</body>
</html> 