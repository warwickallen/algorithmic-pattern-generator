<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fade-to-Black Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #1a1a1a;
            color: #ffffff;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #333;
            border-radius: 8px;
        }
        .controls {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        .btn {
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn:hover {
            background-color: #45a049;
        }
        .btn.secondary {
            background-color: #2196F3;
        }
        .btn.secondary:hover {
            background-color: #1976D2;
        }
        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .slider {
            width: 150px;
        }
        canvas {
            border: 1px solid #333;
            background-color: #000;
        }
        .test-results {
            margin-top: 20px;
            padding: 15px;
            background-color: #2a2a2a;
            border-radius: 4px;
        }
        .test-result {
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
        }
        .pass {
            background-color: #4CAF50;
            color: white;
        }
        .fail {
            background-color: #f44336;
            color: white;
        }
        .info {
            background-color: #2196F3;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Fade-to-Black Functionality Test</h1>
        
        <div class="test-section">
            <h2>Test Controls</h2>
            <div class="controls">
                <button class="btn" onclick="testFadeToBlack()">Test Fade-to-Black</button>
                <button class="btn secondary" onclick="clearResults()">Clear Results</button>
                <div class="slider-container">
                    <label for="fade-cycles">Fade Cycles:</label>
                    <input type="range" id="fade-cycles" min="1" max="20" value="5" class="slider">
                    <span id="fade-cycles-value">5</span>
                </div>
                <div class="slider-container">
                    <label for="brightness">Brightness:</label>
                    <input type="range" id="brightness" min="0.1" max="2.0" step="0.1" value="1.0" class="slider">
                    <span id="brightness-value">100%</span>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>Conway's Game of Life</h2>
            <div class="controls">
                <button class="btn" onclick="startConway()">Start</button>
                <button class="btn secondary" onclick="pauseConway()">Pause</button>
                <button class="btn secondary" onclick="resetConway()">Reset</button>
                <button class="btn secondary" onclick="randomizeConway()">Randomize</button>
            </div>
            <canvas id="conway-canvas" width="400" height="300"></canvas>
        </div>

        <div class="test-section">
            <h2>Termite Algorithm</h2>
            <div class="controls">
                <button class="btn" onclick="startTermite()">Start</button>
                <button class="btn secondary" onclick="pauseTermite()">Pause</button>
                <button class="btn secondary" onclick="resetTermite()">Reset</button>
                <button class="btn secondary" onclick="randomizeTermite()">Randomize</button>
            </div>
            <canvas id="termite-canvas" width="400" height="300"></canvas>
        </div>

        <div class="test-section">
            <h2>Langton's Ant</h2>
            <div class="controls">
                <button class="btn" onclick="startAnt()">Start</button>
                <button class="btn secondary" onclick="pauseAnt()">Pause</button>
                <button class="btn secondary" onclick="resetAnt()">Reset</button>
                <button class="btn secondary" onclick="addAnt()">Add Ant</button>
            </div>
            <canvas id="ant-canvas" width="400" height="300"></canvas>
        </div>

        <div class="test-results" id="test-results">
            <h3>Test Results</h3>
            <div id="results-container">
                <div class="test-result info">Click "Test Fade-to-Black" to run tests</div>
            </div>
        </div>
    </div>

    <script src="simulations.js"></script>
    <script>
        let conwaySim, termiteSim, antSim;
        let currentFadeCycles = 5;
        let currentBrightness = 1.0;

        // Initialize simulations
        function initSimulations() {
            const conwayCanvas = document.getElementById('conway-canvas');
            const termiteCanvas = document.getElementById('termite-canvas');
            const antCanvas = document.getElementById('ant-canvas');

            conwaySim = new ConwayGameOfLife(conwayCanvas, conwayCanvas.getContext('2d'));
            termiteSim = new TermiteAlgorithm(termiteCanvas, termiteCanvas.getContext('2d'));
            antSim = new LangtonsAnt(antCanvas, antCanvas.getContext('2d'));

            // Initialize all simulations
            conwaySim.init();
            termiteSim.init();
            antSim.init();

            // Set initial fade cycles and brightness
            updateFadeCycles();
            updateBrightness();
        }

        // Control functions for Conway's Game of Life
        function startConway() {
            conwaySim.start();
        }

        function pauseConway() {
            conwaySim.pause();
        }

        function resetConway() {
            conwaySim.reset();
        }

        function randomizeConway() {
            conwaySim.randomize(0.3);
        }

        // Control functions for Termite Algorithm
        function startTermite() {
            termiteSim.start();
        }

        function pauseTermite() {
            termiteSim.pause();
        }

        function resetTermite() {
            termiteSim.reset();
        }

        function randomizeTermite() {
            termiteSim.randomize(0.3);
        }

        // Control functions for Langton's Ant
        function startAnt() {
            antSim.start();
        }

        function pauseAnt() {
            antSim.pause();
        }

        function resetAnt() {
            antSim.reset();
        }

        function addAnt() {
            antSim.addAnt();
        }

        // Update fade cycles for all simulations
        function updateFadeCycles() {
            const fadeCycles = parseInt(document.getElementById('fade-cycles').value);
            currentFadeCycles = fadeCycles;
            document.getElementById('fade-cycles-value').textContent = fadeCycles;

            if (conwaySim) conwaySim.setFadeOutCycles(fadeCycles);
            if (termiteSim) termiteSim.setFadeOutCycles(fadeCycles);
            if (antSim) antSim.setFadeOutCycles(fadeCycles);
        }

        // Update brightness for all simulations
        function updateBrightness() {
            const brightness = parseFloat(document.getElementById('brightness').value);
            currentBrightness = brightness;
            document.getElementById('brightness-value').textContent = Math.round(brightness * 100) + '%';

            if (conwaySim) conwaySim.setBrightness(brightness);
            if (termiteSim) termiteSim.setBrightness(brightness);
            if (antSim) antSim.setBrightness(brightness);
        }

        // Test fade-to-black functionality
        function testFadeToBlack() {
            clearResults();
            addResult('info', 'Starting fade-to-black tests...');

            // Test 1: Check if fade cycles are configurable
            testFadeCyclesConfigurable();

            // Test 2: Check if cells fade when deactivated
            testCellFading();

            // Test 3: Check if cells show full brightness when activated
            testInstantActivation();

            // Test 4: Check consistency across simulations
            testConsistency();

            addResult('info', 'Fade-to-black tests completed!');
        }

        function testFadeCyclesConfigurable() {
            addResult('info', 'Testing fade cycles configurability...');
            
            const testCycles = [3, 7, 10];
            let allPassed = true;

            testCycles.forEach(cycles => {
                conwaySim.setFadeOutCycles(cycles);
                const actualCycles = conwaySim.getFadeOutCycles();
                
                if (actualCycles === cycles) {
                    addResult('pass', `✓ Fade cycles set to ${cycles} correctly`);
                } else {
                    addResult('fail', `✗ Fade cycles set to ${cycles} failed (got ${actualCycles})`);
                    allPassed = false;
                }
            });

            // Restore original value
            conwaySim.setFadeOutCycles(currentFadeCycles);

            if (allPassed) {
                addResult('pass', '✓ Fade cycles configurability test passed');
            } else {
                addResult('fail', '✗ Fade cycles configurability test failed');
            }
        }

        function testCellFading() {
            addResult('info', 'Testing cell fading when deactivated...');
            
            // Create a simple pattern and check fade states
            conwaySim.clear();
            
            // Activate a cell
            conwaySim.toggleCell(50, 50);
            conwaySim.draw();
            
            // Check that active cell has no fade state
            const activeFadeFactor = conwaySim.getCellFadeFactor(1, 1);
            if (activeFadeFactor === 1) {
                addResult('pass', '✓ Active cells show full brightness (fade factor = 1)');
            } else {
                addResult('fail', `✗ Active cells should show full brightness, got fade factor = ${activeFadeFactor}`);
            }

            // Deactivate the cell and check fade progression
            conwaySim.toggleCell(50, 50);
            
            // Simulate a few cycles to see fade progression
            for (let cycle = 1; cycle <= Math.min(3, currentFadeCycles); cycle++) {
                conwaySim.draw();
                const fadeFactor = conwaySim.getCellFadeFactor(1, 1);
                const expectedFactor = Math.max(0, 1 - (cycle / currentFadeCycles));
                
                if (Math.abs(fadeFactor - expectedFactor) < 0.1) {
                    addResult('pass', `✓ Cycle ${cycle}: Fade factor ${fadeFactor.toFixed(2)} (expected ~${expectedFactor.toFixed(2)})`);
                } else {
                    addResult('fail', `✗ Cycle ${cycle}: Fade factor ${fadeFactor.toFixed(2)} (expected ~${expectedFactor.toFixed(2)})`);
                }
            }
        }

        function testInstantActivation() {
            addResult('info', 'Testing instant activation of cells...');
            
            // Create a cell that's been fading
            conwaySim.clear();
            conwaySim.toggleCell(50, 50);
            conwaySim.toggleCell(50, 50); // Deactivate it
            
            // Let it fade for a few cycles
            for (let i = 0; i < 3; i++) {
                conwaySim.draw();
            }
            
            // Check that it's fading
            const fadeFactorBefore = conwaySim.getCellFadeFactor(1, 1);
            addResult('info', `Cell fade factor before activation: ${fadeFactorBefore.toFixed(2)}`);
            
            // Activate the cell
            conwaySim.toggleCell(50, 50);
            conwaySim.draw();
            
            // Check that it's now at full brightness
            const fadeFactorAfter = conwaySim.getCellFadeFactor(1, 1);
            if (fadeFactorAfter === 1) {
                addResult('pass', '✓ Cells show instant full brightness when activated');
            } else {
                addResult('fail', `✗ Cells should show instant full brightness, got fade factor = ${fadeFactorAfter}`);
            }
        }

        function testConsistency() {
            addResult('info', 'Testing consistency across simulations...');
            
            const simulations = [
                { name: 'Conway', sim: conwaySim },
                { name: 'Termite', sim: termiteSim },
                { name: 'Langton', sim: antSim }
            ];

            let allConsistent = true;

            simulations.forEach(({ name, sim }) => {
                const fadeCycles = sim.getFadeOutCycles();
                if (fadeCycles === currentFadeCycles) {
                    addResult('pass', `✓ ${name}: Fade cycles consistent (${fadeCycles})`);
                } else {
                    addResult('fail', `✗ ${name}: Fade cycles inconsistent (${fadeCycles}, expected ${currentFadeCycles})`);
                    allConsistent = false;
                }
            });

            if (allConsistent) {
                addResult('pass', '✓ All simulations have consistent fade configuration');
            } else {
                addResult('fail', '✗ Simulations have inconsistent fade configuration');
            }
        }

        function addResult(type, message) {
            const container = document.getElementById('results-container');
            const result = document.createElement('div');
            result.className = `test-result ${type}`;
            result.textContent = message;
            container.appendChild(result);
        }

        function clearResults() {
            const container = document.getElementById('results-container');
            container.innerHTML = '';
        }

        // Event listeners
        document.getElementById('fade-cycles').addEventListener('input', updateFadeCycles);
        document.getElementById('brightness').addEventListener('input', updateBrightness);

        // Initialize when page loads
        window.addEventListener('load', initSimulations);
    </script>
</body>
</html> 